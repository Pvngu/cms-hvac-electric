---
import { Icon } from "astro-icon/components";
import Container from "@components/ui/Container.astro";
import Button from "@components/ui/Button.astro";

// Import videos
import personFixingVideo from "@assets/videos/Person-fixing.mp4";
import factoryIndustrialVideo from "@assets/videos/factory-industrial.mp4";
import fixingHvacVideo from "@assets/videos/fixing-hvac.mp4";

const MEDIA_ITEMS = [
  {
    type: "video",
    src: personFixingVideo,
    duration: 6000,
  },
  {
    type: "video",
    src: factoryIndustrialVideo,
    duration: 5000,
  },
  {
    type: "video",
    src: fixingHvacVideo,
    duration: 6000,
  },
];

const AVATARS = [
  "https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=100&h=100&fit=crop",
  "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=100&h=100&fit=crop",
  "https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&h=100&fit=crop",
];
const STATS = [
  { value: "2000+", label: "Satisfied Clients" },
  { value: "2.98%", label: "On-Time Delivery Rate" },
  { value: "150+", label: "Countries Served" },
  { value: "24/7", label: "Customer Support" },
];
---

<section class="relative min-h-svh flex flex-col overflow-hidden bg-slate-900">
  <!-- Background Media -->
  <div class="absolute inset-0 z-0 bg-black">
    {
      MEDIA_ITEMS.map((item, index) => (
        <div
          class={`absolute inset-0 transition-opacity duration-1000 ease-in-out media-slide size-full ${
            index === 0 ? "opacity-100 relative" : "opacity-0"
          }`}
          data-duration={item.duration}
          data-index={index}
        >
          {item.type === "video" && (
            <video
              autoplay
              muted
              loop
              playsinline
              class="size-full object-cover"
            >
              <source src={item.src} type="video/mp4" />
            </video>
          )}
        </div>
      ))
    }
    <!-- Content Overlay -->
    <div
      class="absolute inset-0 bg-linear-to-r from-black/80 via-black/40 to-transparent z-10"
    >
    </div>
  </div>

  <div class="relative z-20 flex-1 flex flex-col justify-center w-full">
    <Container class="w-full pt-28 pb-12 mt-auto">
      <div class="grid lg:grid-cols-12 gap-12">
        <!-- Content Column -->
        <div class="lg:col-span-7 flex flex-col justify-center space-y-8">
          <div class="space-y-4 max-w-2xl">
            <h1
              class="text-white text-4xl md:text-6xl lg:text-7xl leading-[1.1] font-gilda"
            >
              Expert HVAC service with electrical support
            </h1>
            <p
              class="text-gray-200 text-lg md:text-xl max-w-xl font-inter leading-relaxed"
            >
              We handle your heating and cooling needs with precision.
              Electrical work keeps everything running smooth.
            </p>
          </div>

          <div class="flex flex-wrap items-center gap-2 md:gap-6">
            <Button variant="primary" size="lg"> Book Now </Button>
            <Button variant="link" href="/services"> See Our Services </Button>
          </div>
        </div>
      </div>
    </Container>
  </div>

  <div
    class="relative z-20 border-t border-white/10 bg-black/20 backdrop-blur-sm"
  >
    <Container class="py-8">
      <div
        class="grid grid-cols-2 md:grid-cols-4 gap-y-8 gap-x-4 md:gap-8 divide-x divide-white/10"
      >
        {
          STATS.map((stat) => (
            <div class="px-4 first:pl-0">
              <p class="text-3xl md:text-4xl text-white font-medium mb-1">
                {stat.value}
              </p>
              <p class="text-gray-400 text-sm uppercase tracking-wide">
                {stat.label}
              </p>
            </div>
          ))
        }
      </div>
    </Container>
  </div>
</section>

<script>
  const slides = document.querySelectorAll(".media-slide");
  let timeoutId: NodeJS.Timeout;

  const showSlide = (index: number) => {
    // Hide all
    slides.forEach((slide) => {
      slide.classList.remove("opacity-100", "relative");
      slide.classList.add("opacity-0");

      const video = slide.querySelector("video");
      if (video) {
        video.pause();
      }
    });

    // Show current
    const currentSlide = slides[index];
    currentSlide.classList.remove("opacity-0");
    currentSlide.classList.add("opacity-100", "relative");

    // Play video and reset time
    const video = currentSlide.querySelector("video");
    if (video) {
      video.currentTime = 0;
      video.play();
    }

    // Schedule next
    const duration = parseInt(
      currentSlide.getAttribute("data-duration") || "5000",
    );

    // Clear previous timeout if exists
    if (timeoutId) clearTimeout(timeoutId);

    timeoutId = setTimeout(() => {
      const nextIndex = (index + 1) % slides.length;
      showSlide(nextIndex);
    }, duration);
  };

  if (slides.length > 0) {
    // Start loop
    showSlide(0);
  }
</script>
