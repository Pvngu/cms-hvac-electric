---
import { Icon } from "astro-icon/components";
import Container from "@components/ui/Container.astro";
import Button from "@components/ui/Button.astro";

// Import videos
import personFixingVideo from "@assets/videos/Person-fixing.mp4";
import factoryIndustrialVideo from "@assets/videos/factory-industrial.mp4";
import fixingHvacVideo from "@assets/videos/fixing-hvac.mp4";

const MEDIA_ITEMS = [
  {
    type: "video",
    src: personFixingVideo,
    duration: 6000,
  },
  {
    type: "video",
    src: factoryIndustrialVideo,
    duration: 5000,
  },
  {
    type: "video",
    src: fixingHvacVideo,
    duration: 6000,
  },
];

const AVATARS = [
  "https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=100&h=100&fit=crop",
  "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=100&h=100&fit=crop",
  "https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&h=100&fit=crop",
];
---

<section class="relative h-svh flex items-center overflow-hidden bg-slate-900">
  <!-- Background Media -->
  <div class="absolute inset-0 z-0 bg-black">
    {
      MEDIA_ITEMS.map((item, index) => (
        <div
          class={`absolute inset-0 transition-opacity duration-1000 ease-in-out media-slide size-full ${
            index === 0 ? "opacity-100 relative" : "opacity-0"
          }`}
          data-duration={item.duration}
          data-index={index}
        >
          {item.type === "video" && (
            <video
              autoplay
              muted
              loop
              playsinline
              class="size-full object-cover"
            >
              <source src={item.src} type="video/mp4" />
            </video>
          )}
        </div>
      ))
    }
    <!-- Content Overlay -->
    <div
      class="absolute inset-0 bg-linear-to-r from-black/80 via-black/40 to-transparent z-10"
    >
    </div>
  </div>

  <Container class="relative z-20 w-full pt-20 pb-12 mt-auto">
    <div class="grid lg:grid-cols-12 gap-12">
      <!-- Content Column -->
      <div class="lg:col-span-7 flex flex-col justify-center space-y-8">
        <div class="space-y-4 max-w-2xl">
          <h1
            class="text-white text-5xl md:text-6xl lg:text-7xl leading-[1.1] font-gilda"
          >
            Expert HVAC service with electrical support
          </h1>
          <p
            class="text-gray-200 text-lg md:text-xl max-w-lg font-inter leading-relaxed"
          >
            We handle your heating and cooling needs with precision. Electrical
            work keeps everything running smooth.
          </p>
        </div>

        <div class="flex flex-wrap items-center gap-6">
          <Button variant="primary" size="lg"> Book Now </Button>
          <a
            href="/services"
            class="text-white hover:text-blue-200 underline underline-offset-4 font-medium transition-colors"
          >
            See Our Services
          </a>
        </div>
      </div>
    </div>
  </Container>
</section>

<script>
  const slides = document.querySelectorAll(".media-slide");
  let timeoutId: NodeJS.Timeout;

  const showSlide = (index: number) => {
    // Hide all
    slides.forEach((slide) => {
      slide.classList.remove("opacity-100", "relative");
      slide.classList.add("opacity-0");

      const video = slide.querySelector("video");
      if (video) {
        video.pause();
      }
    });

    // Show current
    const currentSlide = slides[index];
    currentSlide.classList.remove("opacity-0");
    currentSlide.classList.add("opacity-100", "relative");

    // Play video and reset time
    const video = currentSlide.querySelector("video");
    if (video) {
      video.currentTime = 0;
      video.play();
    }

    // Schedule next
    const duration = parseInt(
      currentSlide.getAttribute("data-duration") || "5000"
    );

    // Clear previous timeout if exists
    if (timeoutId) clearTimeout(timeoutId);

    timeoutId = setTimeout(() => {
      const nextIndex = (index + 1) % slides.length;
      showSlide(nextIndex);
    }, duration);
  };

  if (slides.length > 0) {
    // Start loop
    showSlide(0);
  }
</script>
