---
import { Icon } from "astro-icon/components";
import Container from "@components/ui/Container.astro";
import Button from "@components/ui/Button.astro";
import Image from "astro/components/Image.astro";
import logo from "@assets/logo.svg";
import MobileMenu from "@components/shared/MobileMenu.astro";
import { NAV_LINKS, SITE_DATA } from "@data/site";
---

<header
  id="main-header"
  class="fixed top-0 w-full z-[70] transition-all duration-300 border-b border-transparent data-[menu-open=true]:border-transparent"
  data-menu-open="false"
>
  <Container class="flex items-center h-20">
    <!-- Logo -->
    <div class="flex-1 flex justify-start">
      <a href="/" class="flex items-center gap-2 group">
        <Image
          src={logo}
          alt="Logo"
          class="w-20 h-20 fill-white text-white transition-all duration-300"
          id="header-logo"
        />
      </a>
    </div>

    <!-- Navigation -->
    <nav class="hidden lg:flex items-center gap-8">
      {
        NAV_LINKS.map((link) => (
          <Button href={link.href} variant="nav">
            {link.label}
          </Button>
        ))
      }
    </nav>

    <!-- Actions -->
    <div class="flex-1 flex items-center justify-end gap-6">
      <a
        href={`tel:${SITE_DATA.tel}`}
        class="hidden lg:flex items-center gap-2 text-white/90 hover:text-white transition-colors text-sm font-medium"
      >
        <Icon name="phone-call" class="size-4" />
        <span>{SITE_DATA.phone}</span>
      </a>

      <!-- Mobile Phone Link -->
      <a
        href={`tel:${SITE_DATA.tel}`}
        class="lg:hidden text-white hover:text-white/80 transition-colors flex items-center"
        aria-label="Call Business"
        id="mobile-phone-link"
      >
        <Icon name="phone-call" class="size-5" />
      </a>

      <div class="hidden lg:block">
        <Button variant="primary">Contact Us</Button>
      </div>

      <!-- Hamburger Menu Button -->
      <button
        id="hamburger-btn"
        class="lg:hidden p-2 text-white hover:text-white/80 transition-colors cursor-pointer relative z-50"
        aria-label="Toggle menu"
      >
        <Icon
          name="menu"
          class="size-6 transition-opacity duration-300"
          id="icon-menu"
        />
        <Icon
          name="x"
          class="size-6 absolute inset-0 m-auto opacity-0 transition-opacity duration-300 text-black"
          id="icon-close"
        />
      </button>
    </div>
  </Container>
</header>

<MobileMenu />

<style>
  /* Styling based on data-menu-open */
  header[data-menu-open="true"] #header-logo,
  header[data-menu-open="true"] #mobile-phone-link {
    filter: brightness(0);
  }
  header[data-menu-open="true"] #hamburger-btn #icon-menu {
    opacity: 0;
  }
  header[data-menu-open="true"] #hamburger-btn #icon-close {
    opacity: 1;
  }
</style>

<script>
  const header = document.getElementById("main-header");
  const hamburgerBtn = document.getElementById("hamburger-btn");
  const mobileMenu = document.getElementById("mobile-menu");

  const updateHeader = () => {
    if (!header) return;
    if (window.scrollY > 20) {
      header.classList.add(
        "bg-slate-900/90",
        "backdrop-blur-md",
        "border-white/5",
        "shadow-lg",
      );
      header.classList.remove("border-transparent");
    } else {
      header.classList.remove(
        "bg-slate-900/90",
        "backdrop-blur-md",
        "border-white/5",
        "shadow-lg",
      );
      header.classList.add("border-transparent");
    }
  };

  // Toggle Menu
  const toggleMenu = () => {
    if (!mobileMenu || !header) return;

    const isOpen = mobileMenu.dataset.open === "true";
    const newState = !isOpen;

    mobileMenu.dataset.open = String(newState);
    header.setAttribute("data-menu-open", String(newState));

    if (newState) {
      document.body.style.overflow = "hidden";
      // Remove scroll styles when opening
      header.classList.remove(
        "bg-slate-900/90",
        "backdrop-blur-md",
        "border-white/5",
        "shadow-lg",
      );
    } else {
      document.body.style.overflow = "";
      // Re-apply scroll check
      updateHeader();
    }
  };

  window.addEventListener("scroll", updateHeader);
  hamburgerBtn?.addEventListener("click", toggleMenu);

  document.addEventListener("close-menu", () => {
    if (mobileMenu?.dataset.open === "true") {
      toggleMenu();
    }
  });

  // Initial check in case of reload
  updateHeader();
</script>
